package com.hr.spring.tx.service;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Propagation;
import org.springframework.transaction.annotation.Transactional;

import com.hr.spring.tx.dao.BookShopDao;

/**
 * 
 * @Name  : BookShopServiceImpl
 * @Author : LH
 * @Date : 2018年6月28日 下午11:08:31
 * @Version : V1.0
 * 
 * @Description :
 */
@Service("bookShopService")
public class BookShopServiceImpl implements BookShopService {

			@Autowired
			private BookShopDao bookShopDao;
			
			//添加事务注解
			//使用propagation 指定事务的传播行为，即当前事务方法被另外一个事务方法调用时
			//如何使用事务，默认取值 REQUIRED ，即使用调用方法的事务
			//REQUIRES_NEW:使用自己的事务，调用的事务方法的事务被挂起
			@Transactional(propagation =Propagation.REQUIRES_NEW)
			@Override
			public void purchase(String username, String isbn) {
					//1.获取书的单价
					int price = bookShopDao.findBookPriceByIsbn(isbn);
				
					//2.更新书的库存
					 bookShopDao.updateBookStock(isbn);
				
					//3.更新用户的余额
					 bookShopDao.updateUserAccount(username, price);
			}

}
